name: test_db
description: Test database with user data for SQL testing
authors:
  - API Team

tables:
  users: databases/test_db/users.parquet
  user_permissions: databases/test_db/user_permissions.parquet
  posts: databases/test_db/posts.parquet
  user_profiles: databases/test_db/user_profiles.parquet
  active_users: databases/test_db/active_users.parquet

queries:
  get_user_permissions: |
    SELECT [[users]].user_id, [[users]].name, [[user_permissions]].permissions, [[user_permissions]].granted_date
    FROM [[users]]
    JOIN [[user_permissions]] ON [[users]].user_id = [[user_permissions]].user_id
    WHERE [[users]].user_id = {{user_id}}

  get_user_posts: |
    SELECT [[posts]].post_id, [[posts]].title, [[posts]].content, [[posts]].tags
    FROM [[posts]]
    WHERE [[posts]].author = {{user_id}}

  get_active_users: |
    SELECT [[users]].*
    FROM [[users]]
    WHERE [[users]].active = true

routes:
  - route: users
    sql: SELECT [[users]].* FROM [[users]]

  - route: users/active
    sql: "[[get_active_users]]"

  - route: users/{{user_id}}
    sql: SELECT [[users]].* FROM [[users]] WHERE [[users]].user_id = {{user_id}}

  - route: users/{{user_id}}/permissions
    sql: "[[get_user_permissions]]"

  - route: users/{{user_id}}/posts
    sql: "[[get_user_posts]]"

  - route: posts
    sql: SELECT [[posts]].* FROM [[posts]]

  - route: posts/{{post_id}}
    sql: SELECT [[posts]].* FROM [[posts]] WHERE [[posts]].post_id = {{post_id}}