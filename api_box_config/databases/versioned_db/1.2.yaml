name: versioned_db
description: Versioned test database - Version 1.2 (latest)
authors:
  - API Team

tables:
  users: databases/versioned_db/1.2/users.parquet
  user_permissions: databases/versioned_db/1.2/user_permissions.parquet
  posts: databases/versioned_db/1.2/posts.parquet

queries:
  get_user_permissions: |
    SELECT [[users]].user_id, [[users]].name, [[user_permissions]].permissions, [[user_permissions]].granted_date
    FROM [[users]]
    JOIN [[user_permissions]] ON [[users]].user_id = [[user_permissions]].user_id
    WHERE [[users]].user_id = {{user_id}}

  get_user_posts: |
    SELECT [[posts]].post_id, [[posts]].title, [[posts]].content
    FROM [[posts]]
    WHERE [[posts]].author = {{user_id}}

routes:
  - route: users
    sql: SELECT [[users]].* FROM [[users]]

  - route: users/{{user_id}}
    sql: SELECT [[users]].* FROM [[users]] WHERE [[users]].user_id = {{user_id}}

  - route: users/{{user_id}}/permissions
    sql: "[[get_user_permissions]]"

  - route: users/{{user_id}}/posts
    sql: "[[get_user_posts]]"

  - route: posts
    sql: SELECT [[posts]].* FROM [[posts]]
